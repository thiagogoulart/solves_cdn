function SolvesNotifications(){this.solvesPluginName="SolvesNotifications",this.versionId=1,this.version="1.0",this.icon=null,this.permission=Notification.permission,this.actions=[],this.fireBaseConfig=null,this.fireBaseMessaging=null,this.fireBasePublicVapidKey=null,this.fireBaseTokenDivId=null,this.fireBasePermissionDivId=null,this.fireBaseMessagesDivId=null,this.init=function(){$.Solves.addSolvesPlugin(this.solvesPluginName,$.SolvesNotifications)},this.destroy=function(){this.clearData()},this.clearData=function(){this.actions=[]},this.initFireBaseConfig=function(){$.Solves.fireBaseInitialized?(this.fireBaseMessaging=firebase.messaging(),$.Solves.isNotEmpty(this.fireBasePublicVapidKey)&&(this.fireBaseMessaging.usePublicVapidKey(this.fireBasePublicVapidKey),this.fireBaseMonitoreTokenAtual(),this.fireBaseOnMessage())):console.log(this.solvesPluginName+" não encontrou firebaseConfig válida.")},this.setPublicVapidKey=function(e){this.fireBasePublicVapidKey=e},this.setFireBaseTokenDivId=function(e){this.fireBaseTokenDivId=e},this.setFireBasePermissionDivId=function(e){this.fireBasePermissionDivId=e},this.setFireBaseMessagesDivId=function(e){this.fireBaseMessagesDivId=e},this.setIcon=function(e){this.icon=e},this.getIcon=function(){return $.Solves.isNotEmpty(this.icon)?this.icon:$.Solves.icon},this.addAction=function(e,i,s){var o={action:e,title:i};$.Solves.isNotEmpty(s)&&(o.icon=s),this.actions.push(o)},this.notificar=function(e,i,s,o){var t=this.mountJsonMessaging(e,i,s,o);return"Notification"in window?("granted"===Notification.permission?(console.log("Notification permission granted"),this.mostraPwaNotification(i,t)):"denied"!==Notification.permission&&(console.log("Notification permission IS NOT denied"),Notification.requestPermission().then(function(e){$.SolvesNotifications.permission=e,console.log("Notification permission request: "+e),"granted"===e&&this.mostraPwaNotification(i,t)})),void this.clearData()):void console.log("This browser does not support desktop notification")},this.mostraPwaNotification=function(e,i){console.log("mostraPwaNotification = function("+e+", json){"),console.log(i),navigator.serviceWorker.getRegistration().then(function(s){console.log(s),console.log("r3mostraPwaNotification = function("+e+", json){"),console.log(i),s.showNotification(e,i)})},this.mountJsonMessaging=function(e,i,s,o){$.Solves.isNotEmpty(e)||(e=$.Solves.siteShortName+"_"+$.Solves.getDataAtualFormatada()+"_"+Math.random());var t={title:i,body:s,tag:e,icon:this.getIcon()};return $.Solves.isNotEmpty(o)&&(t.image=o),this.actions&&this.actions.length>0&&(t.actions=this.actions),t},this.fireBaseNotificar=function(e,i,s,o){var t=this.mountJsonMessaging(e,i,s,o);return console.log(this.fireBaseMessaging),console.log(this.fireBaseMessaging.permission),"Notification"in window?("granted"===this.fireBaseMessaging.permission?(console.log("Notification permission granted"),this.mostraPwaNotification(i,t)):"denied"!==this.fireBaseMessaging.permission&&(console.log("Notification permission IS NOT denied"),Notification.requestPermission().then(function(e){$.SolvesNotifications.permission=e,console.log("Notification permission request: "+e),"granted"===e&&this.mostraPwaNotification(i,t)})),void this.clearData()):void console.log("This browser does not support desktop notification")},this.fireBaseRequestPermission=function(){console.log("Requesting permission..."),this.fireBaseMessaging.requestPermission().then(function(){console.log("Notification permission granted."),console.log(this.fireBaseMessaging),console.log(this.fireBaseMessaging.permission),fireBaseResetUI()})["catch"](function(e){console.log("Unable to get permission to notify.",e)})},this.fireBaseGetTokenAtual=function(){var e=this;this.fireBaseMessaging.getToken().then(function(i){i?(e.fireBaseSendTokenToServer(i),e.fireBaseUpdateUIForPushEnabled(i)):(console.log("No Instance ID token available. Request permission to generate one."),e.fireBaseUpdateUIForPushPermissionRequired(),e.fireBaseSetTokenSentToServer(!1))})["catch"](function(i){console.log("An error occurred while retrieving token. ",i),e.fireBaseShowToken("Error retrieving Instance ID token. ",i),e.fireBaseSetTokenSentToServer(!1)})},this.fireBaseMonitoreTokenAtual=function(){this.fireBaseMessaging.onTokenRefresh(function(){this.fireBaseMessaging.getToken().then(function(e){console.log("Token refreshed."),this.fireBaseSetTokenSentToServer(!1),this.fireBaseSendTokenToServer(e)})["catch"](function(e){console.log("Unable to retrieve refreshed token ",e),this.fireBaseShowToken("Unable to retrieve refreshed token ",e)})})},this.fireBaseSendTokenToServer=function(){this.fireBaseIsTokenSentToServer()?console.log("Token already sent to server so won't send it again unless it changes"):(console.log("Sending token to server..."),this.fireBaseSetTokenSentToServer(!0))},this.fireBaseIsTokenSentToServer=function(){return"1"===window.localStorage.getItem("sentToServer")},this.fireBaseSetTokenSentToServer=function(e){window.localStorage.setItem("sentToServer",e?"1":"0")},this.fireBaseDeleteToken=function(){this.fireBaseMessaging.getToken().then(function(e){this.fireBaseMessaging.deleteToken(e).then(function(){console.log("Token deleted."),this.fireBaseSetTokenSentToServer(!1),this.fireBaseResetUI()})["catch"](function(e){console.log("Unable to delete token. ",e)})})["catch"](function(e){console.log("Error retrieving Instance ID token. ",e),this.fireBaseShowToken("Error retrieving Instance ID token. ",e)})},this.fireBaseOnMessage=function(){this.fireBaseMessaging.onMessage(function(e){console.log("Message received. ",e),this.fireBaseAppendMessage(e)})},this.fireBaseAppendMessage=function(e){if($.Solves.isNotEmpty(this.fireBaseMessagesDivId)){const i=document.querySelector("#"+this.fireBaseMessagesDivId),s=document.createElement("h5"),o=document.createElement("pre");o.style="overflow-x:hidden;",s.textContent="Received message:",o.textContent=JSON.stringify(e,null,2),i.appendChild(s),i.appendChild(o)}},this.fireBaseClearMessages=function(){if($.Solves.isNotEmpty(this.fireBaseMessagesDivId))for(const e=document.querySelector("#"+this.fireBaseMessagesDivId);e.hasChildNodes();)e.removeChild(e.lastChild)},this.fireBaseUpdateUIForPushEnabled=function(e){$.Solves.isNotEmpty(this.fireBaseTokenDivId)&&this.showHideDiv(this.fireBaseTokenDivId,!0),$.Solves.isNotEmpty(this.fireBasePermissionDivId)&&this.showHideDiv(this.fireBasePermissionDivId,!1),this.fireBaseShowToken(e)},this.fireBaseUpdateUIForPushPermissionRequired=function(){$.Solves.isNotEmpty(this.fireBaseTokenDivId)&&this.showHideDiv(this.fireBaseTokenDivId,!1),$.Solves.isNotEmpty(this.fireBasePermissionDivId)&&this.showHideDiv(this.fireBasePermissionDivId,!0)},this.fireBaseResetUI=function(){this.fireBaseClearMessages(),this.fireBaseShowToken("loading..."),this.fireBaseMessaging.getToken().then(function(e){e?(this.fireBaseSendTokenToServer(e),this.fireBaseUpdateUIForPushEnabled(e)):(console.log("No Instance ID token available. Request permission to generate one."),this.fireBaseUpdateUIForPushPermissionRequired(),this.fireBaseSetTokenSentToServer(!1))})["catch"](function(e){console.log("An error occurred while retrieving token. ",e),this.fireBaseShowToken("Error retrieving Instance ID token. ",e),this.fireBaseSetTokenSentToServer(!1)})},this.fireBaseShowToken=function(e){if($.Solves.isNotEmpty(this.fireBaseTokenDivId)&&$("#"+this.fireBaseTokenDivId).length>0){var i=document.querySelector("#"+this.fireBaseTokenDivId);i.textContent=e}else console.log(e)},this.showHideDiv=function(e,i){var s=$.Solves.getSolvesPlugin("SolvesUi");null!=s?s.showHideDiv(e,i):console.log(this.solvesPluginName+" não encontrou SolvesUi")}}$.SolvesNotifications=new SolvesNotifications,$.SolvesNotifications.init();