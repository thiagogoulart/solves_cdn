function SolvesWebsocket(){this.solvesPluginName="SolvesWebsocket",this.versionId=10,this.version="1.9",this.debug=!1,this.webSocketUrl="ws://...",this.webSocketRoutes=[],this.webSocketRoutesConnections=[],this.reconnection=!0,this.reconnectionAttempts=5,this.reconnectionDelay=3e3,this.reconnectionAttemptsDone=0,this.timeoutOpeningConnectionInSeconds=10,this.secondsTriedOpeningConnection=0,this.doWhenOpen,this.doWhenClose,this.doWhenReceiveMessage,this.doWhenError,this.init=function(){$.Solves.addSolvesPlugin(this.solvesPluginName,$.SolvesWebsocket)},this.afterSolvesInit=function(){this.debug=$.Solves.debug},this.destroy=function(){this.clearData()},this.clearData=function(){this.webSocketUrl="ws://...",this.webSocketRoutes=[],this.webSocketRoutesConnections=[]},this.getPathByParams=function(e,t){var o=this.getConfigWebsocketRoute(e),n=void 0!==o&&null!=o?o.path:null;if(void 0!==t&&null!=t)if(Array.isArray(t)){var s=t.pength;for(i=0;i!=s;i++)n+=(0==i?"?":"&").params[i]}else n+="?"+t;return n},this.getConnection=async function(e,t,o){var n=this.getPathByParams(e,t);return this.getConexao(e,n,o)},this.getConfigWebsocketRoute=function(e){var t=null;for(var o in $.SolvesWebsocket.webSocketRoutes){var n=$.SolvesWebsocket.webSocketRoutes[o];if("function"!=typeof n&&$.Solves.isNotEmpty(n.name)&&n.name==e){t=n;break}}return t},this.getConexao=async function(e,t,o){return $.Solves.isNotEmpty(this.webSocketUrl)?((o=$.Solves.isTrue(o))&&(t=this.addUserTokenAndDataParams(t)),await this.criarConexao(e,t)):(console.log('$.SolvesWebsocket não recebeu a definição do endpoint "webSocketUrl"'),null)},this.getSolvesWebsocketConection=async function(e,t,o,n,s,i){var h=this.webSocketRoutesConnections[t];return null!=h&&(h=h.getConexao()),this.secondsTriedOpeningConnection++,null==h?(this.doWhenOpen=o,this.doWhenClose=n,this.doWhenReceiveMessage=s,this.doWhenError=i,h=await this.doNewConexao(e,t)):null!=h&&3==h.readyState&&(h=await this.restartConnection(e,t)),h},this.criarConexao=async function(e,t){return await this.getSolvesWebsocketConection(e,t,this.doWhenOpen,this.doWhenClose,this.doWhenReceiveMessage,this.doWhenError)},this.doNewConexao=async function(e,t){return this.webSocketRoutesConnections[t]=new SolvesWebsocketConnection(e,t,this.webSocketUrl+t,this.debug,this.doWhenOpen,this.doWhenClose,this.doWhenReceiveMessage,this.doWhenError),await this.webSocketRoutesConnections[t].open()},this.openConnection=async function(e,t){var o=this.getPathByParams(e,t);let n=await this.criarConexao(e,o);return void 0!==n&&null!=n?n.getConexao():null},this.restartConnection=async function(e,t){return conn=await this.doNewConexao(e,t),conn},this.closeConnection=function(e,t,o){let n=this.getPath(e,t,o);var s=this.webSocketRoutesConnections[n];null!=s&&null!=s&&(s.close(),delete this.webSocketRoutesConnections[n])},this.addUserTokenAndDataParams=function(e){var t=$.Solves.getSolvesPlugin("SolvesStorage");if(null!=t){let s=-1!=e.indexOf("?");var o=t.getStorageAuthToken(),n=t.getStorageAuthUserData();$.Solves.isNotEmpty(o)&&(e+=(s?"&":"?")+$.Solves.PARAM_NAME_TOKEN+"="+o,s=!0),$.Solves.isNotEmpty(n)&&(e+=(s?"&":"?")+$.Solves.PARAM_NAME_USERDATA+"="+$.Solves.encondeUrlParam(n),s=!0)}return e},this.getPath=function(e,t,o){let n=this.getPathByParams(e,t);return(o=$.Solves.isTrue(o))&&(n=this.addUserTokenAndDataParams(n)),n},this.sendTxtMsg=function(e,t,o,n,s){this.sendTxtMsgComRestAction(e,t,"","",o,n,!1,s)},this.sendObjMsg=function(e,t,o,n){this.sendObjMsgComRestAction(e,t,"","",o,n,!1,isRestrito)},this.sendTxtMsgComRestAction=function(e,t,o,n,s,i,h,c){let a=this.getPath(e,t,c),r=this.webSocketRoutesConnections[a];null!=r&&void 0!==r&&r.sendTxtMsg(o,n,s,i,h)},this.sendObjMsgComRestAction=function(e,t,o,n,s,i,h,c){let a=this.getPath(e,t,c),r=this.webSocketRoutesConnections[a];null!=r&&void 0!==r&&r.sendObjMsg(o,n,s,i,h)}}function SolvesWebsocketConnection(e,t,o,n,s,i,h,c){this.name=e,this.path=t,this.webSocketUrlWithPath=o,this.IS_SOCKET_ABERTO=!1,this.IS_SOCKET_ABRINDO=!1,this.IS_SOCKET_FAIL=!1,this.IS_SOCKET_FAIL_EXCEPTION=null,this.conn,this.messages=[],this.debug=n,this.STATUS_CONNECTING=0,this.STATUS_OPEN=1,this.STATUS_CLOSING=2,this.STATUS_CLOSED=3,this.doWhenOpen=s,this.doWhenClose=i,this.doWhenReceiveMessage=h,this.doWhenError=c,this.open=async function(){this.IS_SOCKET_FAIL=!1,this.IS_SOCKET_FAIL_EXCEPTION=null,this.IS_SOCKET_ABERTO=!1,this.IS_SOCKET_ABRINDO=!0;try{this.conn=new WebSocket(this.webSocketUrlWithPath);var e=this;this.conn.onopen=function(t){e.onSocketOpen(t)},this.conn.onmessage=function(t){e.onSocketReceiveMessage(t)}}catch(e){this.IS_SOCKET_FAIL=!0,this.IS_SOCKET_FAIL_EXCEPTION=e}return this.conn},this.close=function(){this.conn.close(),this.IS_SOCKET_ABERTO=!1,this.IS_SOCKET_ABRINDO=!1,this.conn=null},this.restart=async function(){return this.close(),await this.open()},this.isClosed=function(){return!(this.IS_SOCKET_ABRINDO||this.IS_SOCKET_ABERTO||null!=this.conn&&this.STATUS_CLOSED!=this.conn.readyState)},this.isClosing=function(){return null!=this.conn&&this.STATUS_CLOSING==this.conn.readyState},this.isOpen=function(){return this.IS_SOCKET_ABERTO||null!=this.conn&&this.STATUS_OPEN==this.conn.readyState},this.isOpening=function(){return this.IS_SOCKET_ABRINDO||null!=this.conn&&this.STATUS_CONNECTING==this.conn.readyState},this.getConexao=function(){return this.conn},this.getConexaoAtiva=async function(){return this.isOpen()||(this.conn=await this.open()),this.conn},this.onSocketOpen=function(e){this.debug&&console.log("onSocketOpen"),this.IS_SOCKET_ABERTO=!0,this.IS_SOCKET_ABRINDO=!1;try{void 0!==this.doWhenOpen&&"function"==typeof this.doWhenOpen?this.doWhenOpen(e):console.log("Não encontrado callback para doWhenOpen")}catch(e){console.log("error on error handling doWhenOpen callback."+e)}},this.onSocketClose=function(e){this.debug&&console.log("onSocketClose"),this.IS_SOCKET_ABERTO=!1,this.IS_SOCKET_ABRINDO=!1;try{void 0!==this.doWhenClose&&"function"==typeof this.doWhenClose?this.doWhenClose(e):console.log("Não encontrado callback para doWhenClose")}catch(e){console.log("error on error handling doWhenClose callback."+e)}},this.onSocketReceiveMessage=function(e){this.debug&&console.log("onSocketReceiveMessage");var t=e.data,o=jQuery.parseJSON(t);this.debug&&(console.log(o),console.log(e));try{void 0!==this.doWhenReceiveMessage&&"function"==typeof this.doWhenReceiveMessage?this.doWhenReceiveMessage(o,e):console.log("Não encontrado callback para doWhenReceiveMessage")}catch(e){console.log("error on error handling doWhenReceiveMessage callback."+e)}},this.onSocketError=function(e){this.debug&&console.log("onSocketError");try{void 0!==this.doWhenError&&"function"==typeof this.doWhenError?this.doWhenError(e.data):console.log("Não encontrado callback para doWhenError")}catch(e){console.log("error on error handling doWhenError callback."+e)}},this.sendTxtMsg=function(e,t,o,n,s){var i=n;("string"==typeof i||i instanceof String)&&(i={msg:n}),this.sendObjMsg(e,t,o,i,s)},this.sendObjMsg=function(e,t,o,n,s){var i=s?this.messages.length+1:null,h=this.getJsonMsgData(e,t,i,o,n);s&&(this.messages[i]=h);try{var c=this;this.getConexaoAtiva().then(e=>{c.debug&&console.log(e),this.conn.send(JSON.stringify(h))})}catch(e){console.log("error on sendingMessage."+e),s&&this.messages[i].remove()}},this.getJsonMsgData=function(e,t,o,n,s){var i={rest:e,rest_method:t},h=$.Solves.getSolvesPlugin("SolvesStorage");if(null!=h){var c=h.getStorageAuthToken(),a=h.getStorageAuthUserData();i.token=c,i.userData=a}return null!=s&&(i.dados=s),null!=o&&null!=o&&(i.msg_id=o),null!=n&&null!=n&&(i.receiver_id=n),i}}$.SolvesWebsocket=new SolvesWebsocket,$.SolvesWebsocket.init();