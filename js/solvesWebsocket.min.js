function SolvesWebsocket(){this.solvesPluginName="SolvesWebsocket",this.versionId=3,this.version="1.2",this.debug=!1,this.webSocketUrl="ws://...",this.webSocketRoutes=[],this.webSocketRoutesConnections=[],this.reconnection=!0,this.reconnectionAttempts=5,this.reconnectionDelay=3e3,this.reconnectionAttemptsDone=0,this.doWhenOpen,this.doWhenClose,this.doWhenReceiveMessage,this.doWhenError,this.init=function(){$.Solves.addSolvesPlugin(this.solvesPluginName,$.SolvesWebsocket)},this.afterSolvesInit=function(){this.debug=$.Solves.debug},this.destroy=function(){this.clearData()},this.clearData=function(){this.webSocketUrl="ws://...",this.webSocketRoutes=[],this.webSocketRoutesConnections=[]},this.getPathByParams=function(e,t){var o=this.getConfigWebsocketRoute(e).path;if(void 0!==t&&null!=t)if(Array.isArray(t)){var n=t.pength;for(i=0;i!=n;i++)o+=(0==i?"?":"&").params[i]}else o+="?"+t;return o},this.getConnection=async function(e,t){var o=this.getPathByParams(e,t);return this.getConexao(e,o),this.getSolvesWebsocketConection(e,o,this.doWhenOpen,this.doWhenClose,this.doWhenReceiveMessage,this.doWhenError)},this.getConfigWebsocketRoute=function(e){var t=null;for(var o in $.SolvesWebsocket.webSocketRoutes){var n=$.SolvesWebsocket.webSocketRoutes[o];if("function"!=typeof n&&$.Solves.isNotEmpty(n.name)&&n.name==e){t=n;break}}return t},this.getConexao=function(e,t,o){(o=$.Solves.isTrue(o))&&(t=this.addUserTokenAndDataParams(t));var n=this.getSolvesWebsocketConection(e,t,this.doWhenOpen,this.doWhenClose,this.doWhenReceiveMessage,this.doWhenError);return null!=n&&null!=n||(n=this.criarConexao(e,t)),void 0!==n&&null!=n?n.getConexao():null},this.getSolvesWebsocketConection=function(e,t){var o=this.webSocketRoutesConnections[t];return null!=o&&o.isClosed()&&(o=this.doNewConexao(e,t)),o},this.criarConexao=function(e,t){var o=this.getSolvesWebsocketConection(e,t,this.doWhenOpen,this.doWhenClose,this.doWhenReceiveMessage,this.doWhenError);return null==o||null==o?this.doNewConexao(e,t):o.isClosed()&&this.webSocketRoutesConnections[t].open(),this.webSocketRoutesConnections[t]},this.doNewConexao=function(e,t){this.webSocketRoutesConnections[t]=new SolvesWebsocketConnection(e,t,this.webSocketUrl+t,this.debug,this.doWhenOpen,this.doWhenClose,this.doWhenReceiveMessage,this.doWhenError),this.webSocketRoutesConnections[t].open()},this.openConnection=function(e,t){var o=this.getPathByParams(e,t),n=this.getSolvesWebsocketConection(e,o,this.doWhenOpen,this.doWhenClose,this.doWhenReceiveMessage,this.doWhenError);null!=n&&null!=n&&n.open()},this.restartConnection=function(e,t){var o=this.getPathByParams(e,t),n=this.getSolvesWebsocketConection(e,o,this.doWhenOpen,this.doWhenClose,this.doWhenReceiveMessage,this.doWhenError);null!=n&&null!=n&&n.restart()},this.closeConnection=function(e,t,o){(o=$.Solves.isTrue(o))&&(n=this.addUserTokenAndDataParams(n));var n=this.getPathByParams(e,t),s=this.getSolvesWebsocketConection(e,n,this.doWhenOpen,this.doWhenClose,this.doWhenReceiveMessage,this.doWhenError);null!=s&&null!=s&&(s.close(),this.webSocketRoutesConnections[n].remove())},this.addUserTokenAndDataParams=function(e){return e+(-1!=e.indexOf("?")?"&":"?")+$.Solves.getTokenUrlParam()},this.sendTxtMsg=function(e,t,o,n){this.sendTxtMsgComRestAction(e,t,"","",o,n,!1)},this.sendObjMsg=function(e,t,o,n){this.sendObjMsgComRestAction(e,t,"","",o,n,!1)},this.sendTxtMsgComRestAction=function(e,t,o,n,s,i,h){this.getConnection(e,t).then(e=>{setTimeout(function(){e.sendTxtMsg(o,n,s,i,h)},e.isOpening()?1e3:0)})},this.sendObjMsgComRestAction=function(e,t,o,n,s,i,h){this.getConnection(e,t).then(e=>{setTimeout(function(){e.sendObjMsg(o,n,s,i,h)},e.isOpening()?1e3:0)})}}function SolvesWebsocketConnection(e,t,o,n,s,i,h,c){this.name=e,this.path=t,this.webSocketUrlWithPath=o,this.IS_SOCKET_ABERTO=!1,this.IS_SOCKET_ABRINDO=!1,this.IS_SOCKET_FAIL=!1,this.IS_SOCKET_FAIL_EXCEPTION=null,this.conn,this.messages=[],this.debug=n,this.STATUS_CONNECTING=0,this.STATUS_OPEN=1,this.STATUS_CLOSING=2,this.STATUS_CLOSED=3,this.doWhenOpen=s,this.doWhenClose=i,this.doWhenReceiveMessage=h,this.doWhenError=c,this.open=async function(){this.IS_SOCKET_FAIL=!1,this.IS_SOCKET_FAIL_EXCEPTION=null,this.IS_SOCKET_ABERTO=!1,this.IS_SOCKET_ABRINDO=!0;try{this.conn=new WebSocket(this.webSocketUrlWithPath);var e=this;this.conn.onopen=function(t){e.onSocketOpen(t)},this.conn.onmessage=function(t){e.onSocketReceiveMessage(t)}}catch(e){this.IS_SOCKET_FAIL=!0,this.IS_SOCKET_FAIL_EXCEPTION=e}return this.conn},this.close=function(){this.conn.close(),this.IS_SOCKET_ABERTO=!1,this.IS_SOCKET_ABRINDO=!1,this.conn=null},this.restart=async function(){this.close(),await this.open()},this.isClosed=function(){return!this.IS_SOCKET_ABERTO&&(null==this.conn||this.STATUS_CLOSED==this.conn.readyState)},this.isClosing=function(){return null!=this.conn&&this.STATUS_CLOSING==this.conn.readyState},this.isOpen=function(){return this.IS_SOCKET_ABERTO||null!=this.conn&&this.STATUS_OPEN==this.conn.readyState},this.isOpening=function(){return this.IS_SOCKET_ABRINDO||null!=this.conn&&this.STATUS_CONNECTING==this.conn.readyState},this.getConexao=function(){return this.conn},this.getConexaoAtiva=async function(){return this.isOpen()||(this.conn=await this.open()),this.conn},this.onSocketOpen=function(e){this.debug&&console.log("onSocketOpen"),this.IS_SOCKET_ABERTO=!0,this.IS_SOCKET_ABRINDO=!1;try{void 0!==this.doWhenOpen&&"function"==typeof this.doWhenOpen?this.doWhenOpen(e):console.log("N達o encontrado callback para doWhenOpen")}catch(e){console.log("error on error handling doWhenOpen callback."+e)}},this.onSocketClose=function(e){this.debug&&console.log("onSocketClose"),this.IS_SOCKET_ABERTO=!1,this.IS_SOCKET_ABRINDO=!1;try{void 0!==this.doWhenClose&&"function"==typeof this.doWhenClose?this.doWhenClose(e):console.log("N達o encontrado callback para doWhenClose")}catch(e){console.log("error on error handling doWhenClose callback."+e)}},this.onSocketReceiveMessage=function(e){this.debug&&console.log("onSocketReceiveMessage");var t=e.data,o=jQuery.parseJSON(t);this.debug&&(console.log(o),console.log(e));try{void 0!==this.doWhenReceiveMessage&&"function"==typeof this.doWhenReceiveMessage?this.doWhenReceiveMessage(o,e):console.log("N達o encontrado callback para doWhenReceiveMessage")}catch(e){console.log("error on error handling doWhenReceiveMessage callback."+e)}},this.onSocketError=function(e){this.debug&&console.log("onSocketError");try{void 0!==this.doWhenError&&"function"==typeof this.doWhenError?this.doWhenError(e.data):console.log("N達o encontrado callback para doWhenError")}catch(e){console.log("error on error handling doWhenError callback."+e)}},this.sendTxtMsg=function(e,t,o,n,s){var i=n;("string"==typeof i||i instanceof String)&&(i={msg:n}),this.sendObjMsg(e,t,o,i,s)},this.sendObjMsg=function(e,t,o,n,s){var i=s?this.messages.length+1:null,h=this.getJsonMsgData(e,t,i,o,n);s&&(this.messages[i]=h);try{var c=this;this.getConexaoAtiva().then(e=>{c.debug&&console.log(e),this.conn.send(JSON.stringify(h))})}catch(e){console.log("error on sendingMessage."+e),s&&this.messages[i].remove()}},this.getJsonMsgData=function(e,t,o,n,s){var i={rest:e,rest_method:t},h=$.Solves.getSolvesPlugin("SolvesStorage");if(null!=h){var c=h.getStorageAuthToken(),r=JSON.stringify(h.getStorageAuthUserData());i.token=c,i.userData=r}return null!=s&&(i.dados=s),null!=o&&null!=o&&(i.msg_id=o),null!=n&&null!=n&&(i.receiver_id=n),i}}$.SolvesWebsocket=new SolvesWebsocket,$.SolvesWebsocket.init();