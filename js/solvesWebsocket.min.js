function SolvesWebsocket(){this.solvesPluginName="SolvesWebsocket",this.versionId=1,this.version="1.0",this.debug=!1,this.webSocketUrl="ws://...",this.webSocketRoutes=[],this.webSocketRoutesConnections=[],this.reconnection=!0,this.reconnectionAttempts=5,this.reconnectionDelay=3e3,this.reconnectionAttemptsDone=0,this.init=function(){$.Solves.addSolvesPlugin(this.solvesPluginName,$.SolvesWebsocket)},this.afterSolvesInit=function(){this.debug=$.Solves.debug},this.destroy=function(){this.clearData()},this.clearData=function(){this.webSocketUrl="ws://...",this.webSocketRoutes=[],this.webSocketRoutesConnections=[]},this.getConexao=function(t){var e=this.getSolvesWebsocketConection(t);return null!=e&&null!=e||(e=this.criarConexao(t)),void 0!==e&&null!=e?e.getConexao():null},this.getSolvesWebsocketConection=function(t){var e=this.webSocketRoutesConnections[t];return null!=e&&e.isClosed()&&(e=this.doNewConexao(t)),e},this.criarConexao=function(t){var e=this.getSolvesWebsocketConection(t);return null==e||null==e?this.doNewConexao(t):e.isClosed()&&this.webSocketRoutesConnections[t].open(),this.webSocketRoutesConnections[t]},this.doNewConexao=function(t){this.webSocketRoutesConnections[t]=new SolvesWebsocketConnection(t,this.webSocketUrl+t),this.webSocketRoutesConnections[t].open()},this.fecharConexao=function(t){var e=this.getSolvesWebsocketConection(t);null!=e&&null!=e&&(e.close(),this.webSocketRoutesConnections[t].remove())}}function SolvesWebsocketConnection(t,e){this.path=t,this.webSocketUrlWithPath=e,this.IS_SOCKET_ABERTO=!1,this.IS_SOCKET_ABRINDO=!1,this.IS_SOCKET_FAIL=!1,this.IS_SOCKET_FAIL_EXCEPTION=null,this.conn,this.messages=[],this.STATUS_CONNECTING=0,this.STATUS_OPEN=1,this.STATUS_CLOSING=2,this.STATUS_CLOSED=3,this.open=async function(){this.IS_SOCKET_FAIL=!1,this.IS_SOCKET_FAIL_EXCEPTION=null,this.IS_SOCKET_ABERTO=!1,this.IS_SOCKET_ABRINDO=!0;try{this.conn=new WebSocket(this.webSocketUrlWithPath);var t=this;this.conn.onopen=function(e){t.onSocketOpen(e)},this.conn.onmessage=function(e){t.onSocketReceiveMessage(e)}}catch(t){this.IS_SOCKET_FAIL=!0,this.IS_SOCKET_FAIL_EXCEPTION=t}return this.conn},this.close=function(){this.conn.close(),this.IS_SOCKET_ABERTO=!1,this.IS_SOCKET_ABRINDO=!1,this.conn=null},this.restart=async function(){this.close(),await this.open()},this.isClosed=function(){return!this.IS_SOCKET_ABERTO&&(null==this.conn||this.STATUS_CLOSED==this.conn.readyState)},this.isClosing=function(){return null!=this.conn&&this.STATUS_CLOSING==this.conn.readyState},this.isOpen=function(){return this.IS_SOCKET_ABERTO||null!=this.conn&&this.STATUS_OPEN==this.conn.readyState},this.isOpening=function(){return this.IS_SOCKET_ABRINDO||null!=this.conn&&this.STATUS_CONNECTING==this.conn.readyState},this.getConexao=function(){return this.conn},this.getConexaoAtiva=async function(){return this.isOpen()||(this.conn=await this.open()),this.conn},this.onSocketOpen=function(t){$.SolvesWebsocket.getSolvesWebsocketConection(this.path).IS_SOCKET_ABERTO=!0,$.SolvesWebsocket.getSolvesWebsocketConection(this.path).IS_SOCKET_ABRINDO=!1},this.onSocketClose=function(t){$.SolvesWebsocket.getSolvesWebsocketConection(this.path).IS_SOCKET_ABERTO=!1,$.SolvesWebsocket.getSolvesWebsocketConection(this.path).IS_SOCKET_ABRINDO=!1},this.onSocketReceiveMessage=function(t){var e=t.data;jQuery.parseJSON(e)},this.onSocketError=function(t){},this.sendTxtMsg=function(t,e,s,o,n){var i=o;("string"==typeof i||i instanceof String)&&(i={msg:o}),this.sendObjMsg(t,e,s,i,n)},this.sendObjMsg=function(t,e,s,o,n){var i=n?this.messages.length+1:null,c=this.getJsonMsgData(t,e,i,s,o);n&&(this.messages[i]=c);try{var h=this;this.getConexaoAtiva().then(t=>{$.SolvesWebsocket.getSolvesWebsocketConection(this.path).conn=t,h.STATUS_OPEN==t.readyState&&t.send(JSON.stringify(c))})}catch(t){n&&this.messages[i].remove()}},this.getJsonMsgData=function(t,e,s,o,n){var i={rest:t,rest_method:e},c=$.Solves.getSolvesPlugin("SolvesStorage");if(null!=c){var h=c.getStorageAuthToken();i.token=h}return null!=n&&(i.dados=n),null!=s&&null!=s&&(i.msg_id=s),null!=o&&null!=o&&(i.receiver_id=o),i},this.getParamRequest=function(t,e,s){var o=null,n=this.getSolvesPlugin("SolvesStorage");return null!=n&&(o=n.getStorageAuthToken()),{type:reqMethod,url:url,processData:!1,contentType:!1,cache:!1,data:t,headers:{Authorization:o},success:function(t){try{e(t),result=jQuery.parseJSON(t),$.Solves.isTrue(result.logoff)&&$.Solves.logoff()}catch(t){}$.Solves.loaded()},error:function(t){try{s(t)}catch(t){}$.Solves.loaded()},complete:function(t){$.Solves.loaded()}}}}$.SolvesWebsocket=new SolvesWebsocket,$.SolvesWebsocket.init();